# React 앱 Docker 이미지화 + 빌드

---

## 1) Dockerfile 작성 (멀티 스테이지)

### Dockerfile

```dockerfile
# 1단계: build stage (React 빌드)
FROM node:20 AS build
WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# 2단계: runtime stage (Nginx로 정적 파일 서빙)
FROM nginx:alpine
COPY nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=build /app/dist /usr/share/nginx/html
```

- 1단계(build): React 앱을 빌드해서 `dist/`를 만든다.
- 2단계(runtime): Nginx 컨테이너에 `dist/`를 넣어 **정적 파일만 서빙**한다.
- 멀티 스테이지(1단계+2단계)를 쓰는 이유: 최종 이미지에 Node/npm을 포함하지 않아 **이미지 크기 감소 + 보안/운영에 유리**하다.

```
# nginx.conf
server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;

  location / {
    try_files $uri $uri/ /index.html;
  }
}
```

ngix.conf 파일 사용 이유

- React Router 사용
- 새로고침/직접 접근 지원
- Kubernetes + Ingress 환경

---

## 2) Docker 이미지 빌드

### 이미지 빌드

```bash
docker build -t sej1991/my-react-vite:v1 .
```

- `docker build`: Dockerfile을 기반으로 이미지를 생성한다.
- `-t sej1991/my-react-vite:v1`: 이미지 이름/태그를 지정한다.
- `.`: 현재 디렉토리를 빌드 컨텍스트로 사용한다.

---

## 3) 로컬 컨테이너 실행 테스트

### 컨테이너 실행

```bash
docker run -p 8080:80 sej1991/my-react-vite:v1
```

- `docker run`: 이미지로 컨테이너를 실행한다.
- `-p 8080:80`: 로컬 8080 포트를 컨테이너 80번 포트(Nginx)에 매핑한다.
- 확인: 브라우저에서 `http://localhost:8080` 접속 시 화면이 정상 렌더링되는지 점검한다.

---

## 4) Docker Hub 로그인 및 Push

### Docker Hub 로그인

```bash
docker login
```

- Docker Hub에 인증하여 `docker push`가 가능해진다.

### 이미지 Push

```bash
docker push sej1991/my-react-vite:v1
```

- 레지스트리에 이미지를 업로드하여 Kubernetes 노드가 `image:`로 pull 할 수 있게 한다.

---

# 빠른 요약

- React 앱을 `npm run build`로 정적 파일(dist)로 빌드했다.
- 멀티 스테이지 Dockerfile로 `dist/`를 Nginx 컨테이너에 포함해 정적 서빙 이미지로 패키징했다.
- `docker build`로 이미지를 생성하고 `docker run`으로 로컬에서 정상 동작을 검증했다.
- `docker push`로 Docker Hub에 업로드해 Kubernetes 배포에 사용할 준비를 마쳤다.

---
