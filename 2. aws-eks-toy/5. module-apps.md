# Apps 모듈 설명

---

## 1) 모듈 역할

- Frontend/Backend를 Deployment로 배포한다.
- Postgres는 StatefulSet + PVC로 영속화한다.
- Ingress(ALB)로 외부 트래픽을 라우팅한다.
- `POSTGRES_HOST=postgres` 유지를 위해 ExternalName Service를 둔다.

---

## 2) .tf 파일 구성

### main.tf

- `kubernetes_namespace`로 `app`/`database` 네임스페이스를 생성한다.
- `kubernetes_storage_class`로 gp2 StorageClass를 옵션 생성한다.
- `kubernetes_stateful_set_v1`로 Postgres를 배포하고 PVC를 연결한다.
- `kubernetes_config_map`으로 init.sql을 주입해 최초 1회 테이블 생성한다.
- `kubernetes_deployment_v1`로 Frontend/Backend를 배포한다.
- `kubernetes_ingress_v1`로 `/`와 `/api`를 각각 라우팅한다.

### variables.tf

- 이미지/포트: `backend_image`, `frontend_image`, `backend_port`, `frontend_port`.
- DB 설정: `db_image`, `db_name`, `db_username`, `db_password`.
- 스토리지: `db_storage_size`, `storage_class_name`, `create_storage_class`.
- Ingress: `ingress_class_name`, `alb_scheme`, `alb_target_type`.

---

# 빠른 요약

- 앱은 Deployment로, DB는 StatefulSet으로 배포된다.
- ALB Ingress로 `/`와 `/api`를 분리한다.
- Postgres는 PVC로 영속화되며 init.sql로 최초 스키마를 만든다.

---
